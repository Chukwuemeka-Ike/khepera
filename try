# Makefile to compile the pose estimator for the Khepera IV robot
#


# Modify this!
KTEAM_HOME := ~/khepera4_development/libkhepera-2.0



LIBKHEPERA_ROOT = ${KTEAM_HOME}

KTEAM_KERNEL_VERSION = 3.5.7-custom

TARGET_SYSTEM	= khepera-${KTEAM_KERNEL_VERSION}

OE_HOME = /usr/local/khepera4-yocto

KHEPERA_TOOLS = ${OE_HOME}

KTEAM_KERNEL_HOME = ${KHEPERA_TOOLS}/build/tmp/sysroots/overo/usr/src

# Variables to assist with the cross-compilation process
ARCH = armv7-a
CROSS_COMPILE = arm-poky-linux-gnueabi-
PATH := $(PATH):${KHEPERA_TOOLS}/build/tmp/sysroots/i686-linux/usr/bin/armv7a-vfp-neon-poky-linux-gnueabi

CC = ${CROSS_COMPILE}gcc
CXX = ${CROSS_COMPILE}g++
LD = ${CROSS_COMPILE}ld
AR = ${CROSS_COMPILE}ar
AS = ${CROSS_COMPILE}as


INCPATH = ${KTEAM_HOME}/build-${KTEAM_KERNEL_VERSION}/include
#INCPATH = ${OE_HOME}/build/tmp/sysroots/overo/usr/include

LIBPATH = ${KTEAM_HOME}/build-${KTEAM_KERNEL_VERSION}/lib
#LIBPATH = ${OE_HOME}/build/tmp/sysroots/overo/usr/lib

# Pointer to the libkhepera build directory
LIBKHEPERA = ${LIBKHEPERA_ROOT}/build-${TARGET_SYSTEM}


SRCS	= $(wildcard *.c)
OBJS	= $(patsubst %.c,%.o,${SRCS})
INCS	= -I ${LIBKHEPERA}/include
LIBS	= -L ${LIBKHEPERA}/lib -lkhepera -lpthread

CFLAGS 	= -O2


objects = cross.o
VPATH = /usr/include/opencv2

cross : $(objects)	-lopencv		# The default goal to create cross execuatble
					@echo "Building $@"
					$(CC) -o $@ $? $(LIBS) $(INCS) $(CFLAGS)
# cross.o : khepera.h opencv2.hpp aruco.hpp



.PHONY : clean
clean :
					-rm cross $(objects)
